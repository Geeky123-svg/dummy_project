<!DOCTYPE html>
<html>
<head>
    <title>Welcome</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        /* General Page Styles */
        body {
            display: flex;
            font-family: Arial, sans-serif;
            margin: 0;
        }

        /* Main Content Styles */
        .main-content {
            flex-grow: 1;
            padding: 20px;
        }

        .section {
            display: none;
        }
    </style>
    <!-- Bootstrap implementation -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="sidebar">
        <h2>User Panel</h2>
        <form action="{{ url_for('user_bp.user_portal') }}" method="get">
            <button type="submit"> Home</button>
        </form>
        <form action="{{ url_for('user_bp.user_profile') }}" method="get">
            <button type="submit"> Your Profile</button>
        </form>
        <form action="{{url_for('user_bp.available_quiz')}}" method="get">
            <button type="submit">Attempt Quiz üéØ</button>
        </form>
        <form action="{{ url_for('user_bp.previous_scores') }}" method="get">
            <button type="submit">Previous Scores üìù</button>
        </form>
        <form action="{{ url_for('user_bp.user_search') }}" method="get">
            <button type="submit">Search üîé</button>
        </form>
        <form action="{{ url_for('main_bp.logout') }}" method="post">
            <button type="submit" class="logout-btn">üö™ Logout</button>
        </form>
    </div>
    <div class="main-content">
        {% block content %}
        <h1>Welcome {{ username }}!</h1>
        <p>This is the user dashboard</p>

        <div class="dashboard" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
            <div class="card">
                <h3>Quiz Attempts Over Time</h3>
                {% if no_attempts %}
                    <p style="color: gray;">You haven‚Äôt attempted any quizzes yet.</p>
                {% else %}
                    <canvas id="attemptsChart"></canvas>
                {% endif %}
            </div>

            <div class="card">
                <h3>Score Distribution</h3>
                {% if no_attempts %}
                    <p style="color: gray;">No quiz scores available.</p>
                {% else %}
                    <canvas id="scoresChart"></canvas>
                {% endif %}
            </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

        {% if not no_attempts %}
        <script>
        // eslint-disable

        const attemptsCtx = document.getElementById('attemptsChart').getContext('2d');
        new Chart(attemptsCtx, {
            type: 'line',
            data: {
                labels: JSON.parse('{{ attempts_over_time.labels | tojson | safe }}'),
                datasets: [{
                    label: 'Attempts',
                    data: JSON.parse('{{ attempts_over_time.data | tojson | safe }}'),
                    borderColor: 'rgba(75, 192, 192, 1)',
                    fill: false,
                    tension: 0.3
                }]
            }
        });

        const scoreDistribution = JSON.parse('{{ score_distribution | tojson | safe }}');

        const scoresCtx = document.getElementById('scoresChart').getContext('2d');
        new Chart(scoresCtx, {
            type: 'bar',
            data: {
                labels: ['0-50%', '51-70%', '71-85%', '86-100%'],
                datasets: [{
                    label: 'Quizzes Count',
                    data: [
                        scoreDistribution['0-50'],
                        scoreDistribution['51-70'],
                        scoreDistribution['71-85'],
                        scoreDistribution['86-100']
                    ],
                    backgroundColor: 'rgba(153, 102, 255, 0.6)'
                }]
            }
        });

        // eslint-enable
        </script>
        {% endif %}
        {% endblock %}
    </div>
</body>
</html>